<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sentiment Index Evaluation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/1.1.1/chartjs-plugin-zoom.min.js"></script>
</head>
<body>
    <header>
        <h1>Stock Prediction Project</h1>
    </header>
    <nav>
        <button id="nav-toggle" onclick="toggleNav()">â˜°</button>
        <ul id="nav-list">
            <li><a href="{{ url_for('home') }}">Home</a></li>
            <li><a href="{{ url_for('about') }}">About</a></li>
            <li><a href="{{ url_for('contact') }}">Contact</a></li>
        </ul>
    </nav>
    <main>
        <section id="intro">
            <h2>Introduction</h2>
            <p>This project displays the impact of sentiment on Tesla stock.<br>
            The below plot displays the predicted stock price of Tesla (TSLA) using <br>
                the last 6 months of stock and sentiment dating from YFinance and Alpha Vantage. <br>
                The 6 months of data are used in a Long Short Term Memory neural network to produce
                a price prediction using stock data only and stock data combined with normalized sentiment data. <br>
                Notice: This is a prediction generated by artificial intelligence. It is not investment advice.
            </p>
        </section>
        <!-- ADD RESULTS SECTION -->
        <section id="plot-section">
            <h2>Plot</h2>
            <p>Click a selector to remove it from the chart. </p>
            <!-- Add a canvas element where the chart will be drawn -->
            <canvas id="plotCanvas" width="400" height="200"></canvas>
        </section>
    </main>
    <footer>
        <p>&copy; 2023, Stock Prediction Project</p>
    </footer>

    <!-- Add a script to fetch data and update the chart -->
    <script>
  fetch('/get_plot_data')
    .then(response => response.json())
    .then(plotDataList => {  // Assuming plotDataList is already a JavaScript object after parsing JSON

        // Extract labels for the chart (dates)
        const labels = plotDataList.map(data => data.date);

        // Prepare datasets for actual, predicted with sentiment, and predicted stock only
        const actualDataset = {
            label: 'Actual',
            data: plotDataList.map(data => data.actual),
            borderColor: 'rgba(0, 0, 255, 0.5)',
            fill: false
        };

        const predictedWithSentimentDataset = {
            label: 'Predicted with Sentiment',
            data: plotDataList.map(data => data.predicted_with_sentiment),
            borderColor: 'rgba(0, 255, 0, 0.5)',
            fill: false
        };

        const predictedStockOnlyDataset = {
            label: 'Predicted Stock Only',
            data: plotDataList.map(data => data.predicted_stock_only),
            borderColor: 'rgba(255, 0, 0, 0.5)',
            fill: false
        };

        // Create the datasets array using the datasets created above
        const datasets = [actualDataset, predictedWithSentimentDataset, predictedStockOnlyDataset];

        // Get the context of the canvas to draw the chart
        const ctx = document.getElementById('plotCanvas').getContext('2d');

        // Instantiate the chart
        const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                plugins: {
                    zoom: {
                        pan: {
                            enabled: true,
                            mode: 'x'
                        },
                        zoom: {
                            enabled: true,
                            mode: 'x'
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day'
                        },
                        title: {
                            display: true,
                            text: 'Date'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Stock Value (USD $)'
                        }
                    }
                }
            }
        });
    });
</script>
    <script>
        function toggleNav() {
            const navList = document.getElementById('nav-list');
            if (navList.style.display === 'block') {
                navList.style.display = 'none';
            } else {
                navList.style.display = 'block';
            }
        }
    </script>
</body>
</html>
